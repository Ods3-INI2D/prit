<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador - Painel de Controle</title>
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <header>
        <img src="/imagens/logo.png" alt="Logotipo da Farmácia" class="logo">
        <h1 class="titulo">Painel Administrativo</h1>
    </header>
 
    <main>
        <% if(erro) { %>
            <output class="mensagem-erro" role="alert" aria-live="assertive">
                <%= erro %>
            </output>
        <% } %>
        
        <% if(sucesso) { %>
            <output class="mensagem-sucesso" role="status" aria-live="polite">
                <%= sucesso %>
            </output>
        <% } %>

        <section class="estatisticas" aria-labelledby="titulo-estatisticas">
            <h2 id="titulo-estatisticas" class="subtitulo">Estatísticas do Site</h2>
            
            <div class="estatisticas-grid">
                <article class="card-stats">
                    <h3 class="stat-titulo">Total de Produtos</h3>
                    <p class="stat-valor" aria-label="<%= totalProdutos %> produtos cadastrados"><%= totalProdutos %></p>
                </article>
     
                <article class="card-stats">
                    <h3 class="stat-titulo">Total de Avaliações</h3>
                    <p class="stat-valor" aria-label="<%= totalAvaliacoes %> avaliações recebidas"><%= totalAvaliacoes %></p>
                </article>
            </div>
        </section>
 
        <section class="adicionar-produto" aria-labelledby="titulo-adicionar">
            <h2 id="titulo-adicionar" class="subtitulo">Adicionar Novo Produto</h2>
            
            <form method="POST" action="/admin/adicionar-produto" class="form-produto" enctype="multipart/form-data" aria-label="Formulário de cadastro de produto">
                <label for="nome">
                    <span class="label-titulo">Nome do Produto</span>
                    <input type="text" id="nome" name="nome" placeholder="Digite o nome do produto" required aria-required="true">
                </label>
 
                <label for="preco">
                    <span class="label-titulo">Preço</span>
                    <input type="number" id="preco" name="preco" placeholder="0.00" step="0.01" min="0" required aria-required="true">
                </label>
 
                <label for="precoDesconto">
                    <span class="label-titulo">Preço com Desconto (opcional)</span>
                    <input type="number" id="precoDesconto" name="precoDesconto" placeholder="0.00" step="0.01" min="0" aria-required="false">
                </label>
 
                <label for="categoria">
                    <span class="label-titulo">Categoria</span>
                    <select id="categoria" name="categoria" required aria-required="true">
                        <option value="">Selecione uma categoria</option>
                        <option value="Cuidados com a Pele">Cuidados com a Pele</option>
                        <option value="Higiene Bucal">Higiene Bucal</option>
                        <option value="Cabelo">Cabelo</option>
                        <option value="Vitaminas e Suplementos">Vitaminas e Suplementos</option>
                        <option value="Bebê">Bebê</option>
                        <option value="Terceira Idade">Terceira Idade</option>
                        <option value="Medicamentos">Medicamentos</option>
                    </select>
                </label>
 
                <fieldset class="campo-imagem">
                    <legend>
                        <span class="label-titulo">Imagem do Produto</span>
                    </legend>
                    <label for="imagem" class="label-arquivo">
                        <input type="file"
                               id="imagem"
                               name="imagem"
                               accept="image/jpeg,image/jpg,image/png,image/webp"
                               aria-describedby="imagem-info">
                        <output id="imagem-info" class="info-arquivo">
                            Formatos aceitos: JPG, JPEG, PNG, WEBP (máx. 5MB)
                        </output>
                    </label>
                    <output id="preview-imagem" class="preview-container" role="status" aria-live="polite"></output>
                </fieldset>
 
                <label for="descricao">
                    <span class="label-titulo">Descrição do Produto</span>
                    <textarea id="descricao" name="descricao" placeholder="Digite a descrição do produto" rows="5" required aria-required="true"></textarea>
                </label>
 
                <button type="submit" class="btn-adicionar">Adicionar Produto</button>
            </form>
        </section>
 
        <section class="lista-produtos" aria-labelledby="titulo-lista">
            <h2 id="titulo-lista" class="subtitulo">Produtos Cadastrados</h2>
            
            <% if(produtos.length === 0) { %>
                <p class="mensagem-vazia">Nenhum produto cadastrado ainda.</p>
            <% } else { %>
                <ul class="produtos-lista" role="list">
                    <% produtos.forEach(function(produto) { %>
                        <li class="produto-item" role="listitem">
                            <div class="produto-info-container">
                                <div>
                                    <h3 class="produto-nome"><%= produto.nome %></h3>
                                    <p class="produto-info">ID: <%= produto.id %></p>
                                </div>
                                <p class="produto-info">Categoria: <%= produto.categoria %></p>
                                <p class="produto-info produto-preco">R$ <%= produto.preco.toFixed(2) %></p>
                                <% if(produto.precoDesconto) { %>
                                    <p class="produto-info desconto">Com Desconto: R$ <%= produto.precoDesconto.toFixed(2) %></p>
                                <% } %>
                            </div>
                            <nav class="acoes-produto" aria-label="Ações do produto <%= produto.nome %>">
                                <button class="btn-editar" type="button" aria-label="Editar produto <%= produto.nome %>">Editar</button>
                                <button class="btn-excluir" type="button" aria-label="Excluir produto <%= produto.nome %>">Excluir</button>
                            </nav>
                        </li>
                    <% }); %>
                </ul>
            <% } %>
        </section>
    </main>
 
    <footer>
        <nav aria-label="Navegação do rodapé">
            <a href="/home" class="link-footer">Voltar ao Site</a>
        </nav>
    </footer>
 
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inputImagem = document.getElementById('imagem');
            const previewContainer = document.getElementById('preview-imagem');
            const infoArquivo = document.getElementById('imagem-info');
 
            if (inputImagem) {
                inputImagem.addEventListener('change', function(e) {
                    const arquivo = e.target.files[0];
                    
                    if (!arquivo) {
                        previewContainer.innerHTML = '';
                        infoArquivo.textContent = 'Formatos aceitos: JPG, JPEG, PNG, WEBP (máx. 5MB)';
                        infoArquivo.style.color = '';
                        return;
                    }
 
                    // Validação de tamanho (5MB)
                    if (arquivo.size > 5 * 1024 * 1024) {
                        infoArquivo.textContent = 'Erro: A imagem deve ter no máximo 5MB';
                        infoArquivo.style.color = '#d93025';
                        previewContainer.innerHTML = '';
                        inputImagem.value = '';
                        return;
                    }
 
                    // Validação de tipo
                    const tiposPermitidos = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
                    if (!tiposPermitidos.includes(arquivo.type)) {
                        infoArquivo.textContent = 'Erro: Formato não suportado. Use JPG, PNG ou WEBP';
                        infoArquivo.style.color = '#d93025';
                        previewContainer.innerHTML = '';
                        inputImagem.value = '';
                        return;
                    }
 
                    // Preview da imagem
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const figure = document.createElement('figure');
                        figure.className = 'preview-figure';
                        
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = 'Preview da imagem do produto';
                        img.className = 'preview-img';
                        
                        const figcaption = document.createElement('figcaption');
                        figcaption.textContent = arquivo.name;
                        figcaption.className = 'preview-caption';
                        
                        figure.appendChild(img);
                        figure.appendChild(figcaption);
                        previewContainer.innerHTML = '';
                        previewContainer.appendChild(figure);
                        
                        infoArquivo.textContent = 'Imagem selecionada com sucesso!';
                        infoArquivo.style.color = '#4da6ff';
                    };
                    reader.readAsDataURL(arquivo);
                });
            }
        });
    </script>
</body>
</html>