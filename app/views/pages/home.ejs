<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/estilo.css">
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/bloco.css">
    <link rel="stylesheet" href="/css/carousel.css">
</head>
<body>
    <header>
        <%- include('../partial/grid.ejs') %>
    </header>

    <main>
        <section class="carousel-container" aria-label="Carrossel de destaques">
            <figure class="carousel-slide active" aria-hidden="false">
                <img src="/imagens/banner1.png" alt="Primeira imagem do carrossel - Promoções especiais">
                <figcaption class="carousel-caption">Promoções Especiais</figcaption>
            </figure>
            
            <figure class="carousel-slide" aria-hidden="true">
                <img src="/imagens/banner2.png" alt="Segunda imagem do carrossel - Ofertas da semana">
                <figcaption class="carousel-caption">Ofertas da Semana</figcaption>
            </figure>
            
            <figure class="carousel-slide" aria-hidden="true">
                <img src="/imagens/banner3.png" alt="Terceira imagem do carrossel - Ofertas da semana">
                <figcaption class="carousel-caption">Ofertas da Semana</figcaption>
            </figure>

            <nav class="carousel-controls" aria-label="Controles do carrossel">
                <button class="carousel-btn prev" aria-label="Slide anterior">❮</button>
                <button class="carousel-btn next" aria-label="Próximo slide">❯</button>
            </nav>

            <nav class="carousel-indicators" aria-label="Indicadores do carrossel">
                <button class="indicator active" aria-label="Ir para slide 1" data-slide="0"></button>
                <button class="indicator" aria-label="Ir para slide 2" data-slide="1"></button>
                <button class="indicator" aria-label="Ir para slide 3" data-slide="2"></button>
            </nav>
        </section>

        <section class="produtos-container">
            <% if(produtos && produtos.length > 0) { %>
                <% produtos.forEach(function(produto) { %>
                    <article class="bloco-produto-home">
                        <a href="/produto/<%= produto.id %>" class="link-produto-home">
                            <img src="<%= produto.imagem %>" alt="<%= produto.nome %>" class="imagem-produto-home">

                            <h2 class="nome-produto-home"><%= produto.nome %></h2>

                            <% if(produto.precoDesconto) { %>
                                <section class="preco-container-home">
                                    <p class="preco-original-home">R$ <%= produto.preco.toFixed(2) %></p>
                                    <p class="preco-desconto-home">R$ <%= produto.precoDesconto.toFixed(2) %></p>
                                    <aside class="badge-desconto">
                                        <p class="percentual-home">-<%= Math.round(((produto.preco - produto.precoDesconto) / produto.preco) * 100) %>%</p>
                                        <img src="/imagens/setab.png" alt="Desconto" class="seta-badge">
                                    </aside>
                                </section>
                            <% } else { %>
                                <p class="preco-unico-home">R$ <%= produto.preco.toFixed(2) %></p>
                            <% } %>

                            <p class="categoria-home"><%= produto.categoria %></p>

                            <% if(produto.avaliacoes && produto.avaliacoes.length > 0) { %>
                                <section class="estrelas-home">
                                    <% 
                                    const somaNotas = produto.avaliacoes.reduce((sum, av) => sum + av.nota, 0);
                                    const media = somaNotas / produto.avaliacoes.length;
                                    const notaArredondada = Math.round(media);
                                    for(let i = 1; i <= 5; i++) { %>
                                        <img src="/imagens/estr<%= i <= notaArredondada ? '' : 'v' %>.png" alt="Estrela" class="estrela-home">
                                    <% } %>
                                </section>
                            <% } %>
                        </a>
                    </article>
                <% }); %>
            <% } else { %>
                <article class="sem-produtos">
                    <p class="mensagem-vazio">Nenhum produto disponível no momento.</p>
                    <a href="/admin" class="btn-admin">Ir para Administração</a>
                </article>
            <% } %>
        </section>
    </main>

    <footer>
        <%- include('../partial/footer.ejs') %>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const slides = document.querySelectorAll('.carousel-slide');
            const prevBtn = document.querySelector('.carousel-btn.prev');
            const nextBtn = document.querySelector('.carousel-btn.next');
            const indicators = document.querySelectorAll('.indicator');
            let currentSlide = 0;
            let autoPlayInterval;

            function showSlide(n) {
                slides.forEach(slide => {
                    slide.classList.remove('active');
                    slide.setAttribute('aria-hidden', 'true');
                });
                indicators.forEach(ind => ind.classList.remove('active'));

                currentSlide = (n + slides.length) % slides.length;
                
                slides[currentSlide].classList.add('active');
                slides[currentSlide].setAttribute('aria-hidden', 'false');
                indicators[currentSlide].classList.add('active');
            }

            function nextSlide() {
                showSlide(currentSlide + 1);
            }

            function prevSlide() {
                showSlide(currentSlide - 1);
            }

            function startAutoPlay() {
                autoPlayInterval = setInterval(nextSlide, 5000);
            }

            function stopAutoPlay() {
                clearInterval(autoPlayInterval);
            }

            prevBtn.addEventListener('click', function() {
                prevSlide();
                stopAutoPlay();
                startAutoPlay();
            });

            nextBtn.addEventListener('click', function() {
                nextSlide();
                stopAutoPlay();
                startAutoPlay();
            });

            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', function() {
                    showSlide(index);
                    stopAutoPlay();
                    startAutoPlay();
                });
            });

            startAutoPlay();

            const carouselContainer = document.querySelector('.carousel-container');
            carouselContainer.addEventListener('mouseenter', stopAutoPlay);
            carouselContainer.addEventListener('mouseleave', startAutoPlay);
        });
    </script>
</body>
</html>